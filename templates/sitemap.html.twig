<?xml version="1.0" encoding="UTF-8"?>
{% if userview | default %}<?xml-stylesheet type="text/xsl" href="{{ path('ali_sitemaps_sitemap_xsl') }}"?>{% endif %}
<urlset
    xmlns="http://www.sitemaps.org/schemas/sitemap/0.9"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.sitemaps.org/schemas/sitemap/0.9 http://www.sitemaps.org/schemas/sitemap/0.9/sitemap.xsd"
    xmlns:xhtml="http://www.w3.org/1999/xhtml"
    xmlns:image="http://www.google.com/schemas/sitemap-image/1.1"
>
    {% for url in nodes %}
        <url>
            {# Vérifie si l'URL commence déjà par le hostname pour éviter les doublons #}
            <loc>
                {% if url.loc starts with hostname %}
                    {{ url.loc }}
                {% else %}
                    {{ hostname ~ url.loc }}
                {% endif %}
            </loc>

            {# Ajoute lastmod uniquement si défini et valide #}
            {% if url.lastmod is defined and url.lastmod is not empty %}
                <lastmod>{{ url.lastmod|date("Y-m-d\TH:i:sP") }}</lastmod>
            {% endif %}

            {# Ajoute changefreq uniquement si défini et valide #}
            {% if url.changefreq is defined and url.changefreq is not empty and url.changefreq in ['always', 'hourly', 'daily', 'weekly', 'monthly', 'yearly', 'never'] %}
                <changefreq>{{ url.changefreq }}</changefreq>
            {% endif %}

            {# Ajoute priority uniquement si défini et valide (entre 0.0 et 1.0) #}
            {% if url.priority is defined and url.priority is not empty and url.priority >= 0.0 and url.priority <= 1.0 %}
                <priority>{{ url.priority|number_format(1, '.') }}</priority>
            {% endif %}

            {# Ajoute les balises image si définies #}
            {% if url.image is defined and url.image is not empty %}
                <image:image>
                    <image:loc>
                        {% if url.image.loc starts with hostname %}
                            {{ url.image.loc }}
                        {% else %}
                            {{ hostname ~ url.image.loc }}
                        {% endif %}
                    </image:loc>
                    {% if url.image.title is defined and url.image.title is not empty %}
                        <image:title><![CDATA[{{ url.image.title }}]]></image:title>
                    {% endif %}
                </image:image>
            {% endif %}
        </url>
    {% endfor %}
</urlset>